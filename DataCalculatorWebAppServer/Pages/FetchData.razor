@*This is the query page*@
@page "/fetchdata"
@using BlazorInputFile
@using Models
@using Data
@using Services

@inject DataCalculatorDbContext _context 
@inject IFileHandler _fileHandler
<h1>Download file for query</h1>

@*<form action="/action_page.php">
  <label for="yearstart">Choose a start year:</label>
  <select id="yearstart" name="years">
    <option value="2016">2016</option>
    <option value="2017">2017</option>
    <option value="2018">2018</option>
    <option value="2019">2019</option>
    <option value="2020">2020</option>
    <option value="2021">2021</option>
  </select>
  <input type="submit">
</form>*@
<button @onclick = "@DownloadFile" >Click to begin</button>


@code{
    private async Task DownloadFile(string[]fileList)
    {
        foreach(var fiName in fileList)
        {
            var file = await _fileHandler.DownloadFileAsync(fiName);
            SaveData(file);
        }
    }

    protected bool SaveData(TransferFile byteFile)
    {
        BinaryWriter Writer = null;
        string Name = @"C:.\Downloads\";

        try
        {
            // Create a new stream to write to the file
            Writer = new BinaryWriter(File.OpenWrite(Name + byteFile.Name));

            // Writer raw data                
            Writer.Write(byteFile.Content);
            Writer.Flush();
            Writer.Close();
        }
        catch 
        {
            return false;
        }

        return true;
    }
    
}
